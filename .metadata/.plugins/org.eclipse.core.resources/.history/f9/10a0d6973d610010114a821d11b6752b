-- 1번 : 제약조건

--SELECT * FROM tbl_student;
SELECT * FROM TBL_SCHOOL;

INSERT INTO TBL_SCHOOL
VALUES(1, '코리아고등학교');
--VALUES(2, '코리아it고등학교');
--VALUES(3, '한국고등학교');
--VALUES(1, '한국it고등학교'); -- SCHOOL_NUMBER는 PK로 설정된 컬럼이기 때문에 중복값 불가
--VALUES(4, NULL);  -- SCHOOL_NUMBER는 PK로 설정된 컬럼이므로 NULL 불가

--DROP TABLE TBL_SCHOOL;

INSERT INTO TBL_STUDENT
--VALUES(1, '짱구', 17, 1);
--VALUES(2, '철수', 17, 1); -- SCHOOL_NUMBER는 FK이므로 중복값 가능
--VALUES(3, '유리', 17, 2);
--VALUES (3, '맹구', 17, 3); -- STUDENT_NUMBER는 PK이므로 중복값 불가
--VALUES (4, '맹구', 17, 3); 
--VALUES(5, '훈이', 17, NULL); -- SCHOOL_NUMBER는 FK이므로 NULL값 가능
VALUES(6, NULL, NULL, NULL);

SELECT * FROM TBL_STUDENT;

-- FK에 없는 값을 넣으면 오류 발생, FK에 중복값 가능, FK에 NULL값도 가능
-- PK는 중복값 불가, NULL 불가

-- STUDENT 테이블에 STUDENT_NAME 컬럼에 UNIQUE 제약조건 추가(중복이름 허용X)
ALTER TABLE TBL_STUDENT
ADD CONSTRAINT UQ_STUDENT_NAME (STUDENT_NAME);

SELECT * FROM TBL_STUDENT;

INSERT INTO TBL_STUDENT 
--VALUES(7, NULL, NULL, NULL); --STUDENT_NAME 컬럼에 UNIQUE 제약조건이 있으면 NULL값 가능, 중복값 불가
VALUES(8, '짱구', NULL, NULL);

DELETE FROM TBL_STUDENT
--WHERE STUDENT_SCHOOL_NAME IS NULL;
--WHERE STUDENT_NUMBER = 5;

DELETE FROM TBL_STUDENT 
WHERE STUDENT_NAME = '맹구';

SELECT * FROM TBL_STUDENT;

DELETE FROM TBL_SCHOOL 
WHERE SCHOOL_NUMBER = 1;

ALTER TABLE TBL_STUDENT 
RENAME COLUMN STUDENT_SCHOOL_NAME TO SCHOOL_NUMBER;

-- 상위 테이블 TBL_SCHOOL의 값을 삭제할 때는
-- 참조하고 있는 테이블에서 사용중인지 확인 후 삭제가 가능하다
-- 1) 자식(하위) 테이블에서 해당 컬럼의 값을 NULL로 수정 후 삭제
UPDATE TBL_STUDENT
SET STUDENT_SCHOOL_NAME = NULL
--WHERE STUDENT_SCHOOL_NAME = 2;
--WHERE SCHOOL_NUMBER = 2;

DELETE FROM TBL_STUDENT 
WHERE SCHOOL_NUMBER = 2;

SELECT * FROM TBL_STUDENT;
SELECT * FROM TBL_SCHOOL;
-- 2) 자식 테이블에서 해당 행을 삭제 후 상위 테이블 삭제

-- 테이블 생성
-- 학생테이블 삭제 후 다시 생성
/* 
 * 학생번호 	STU_NUMBER	PK
 * 학생아이디 	SUT_ID		UK
 * 학생 이름	STU_NAME
 * 전공		STU_MAJOR
 * 성별		STU_GENDER	--	'M' 또는 'W'만 저장할 것
 */
-- 테이블 생성 후 컬럼 추가 SCHOOL_NUMBER FK 제약조건 추가

DROP TABLE TBL_STUDENT;

CREATE TABLE TBL_STUDENT 
( 
	STU_NUMBER NUMBER,
	STU_ID VARCHAR2(100),
	STU_NAME VARCHAR2(100),
	STU_MAJOR VARCHAR2(100),
	STU_GENDER CHAR(1),
	CONSTRAINT PK_STU_NUMBER PRIMARY KEY (STU_NUMBER),
	CONSTRAINT UK_STU_ID UNIQUE (STU_ID)
);

ALTER TABLE TBL_STUDENT
ADD (SCHOOL_NUMBER NUMBER);
--ADD CONSTRAINT SCHOOL_NUMBER FK FOREIGN KEY (SCHOOL_NUMBER) REFERENCES TBL_STUDENT(STU_NUMBER);

SELECT * FROM TBL_SCHOOL;
SELECT * FROM TBL_STUDENT;

INSERT INTO TBL_STUDENT 
VALUES(1, 'GU', '짱구', '컴퓨터공학과', 'A', 1);

DROP TABLE TBL_SCHOOL;

CREATE TABLE TBL_SCHOOL(
--   SCHOOL_NUMBER NUMBER CONSTRAINT PK_SCHOOL PRIMARY KEY, 가능하나 아래쪽에 작성한다
   SCHOOL_NUMBER NUMBER,
   SCHOOL_NAME VARCHAR2(100),
   CONSTRAINT PK_SCHOOL PRIMARY KEY(SCHOOL_NUMBER)
);

SELECT * FROM TBL_SCHOOL;

INSERT INTO TBL_SCHOOL
--VALUES(1, '코리아고등학교');
--VALUES(2, '코리아it고등학교');
--VALUES(3, '한국고등학교');
--VALUES(1, '한국it고등학교'); -- SCHOOL_NUMBER는 PK로 설정된 컬럼이기 때문에 중복값 불가
--VALUES(NULL, NULL); -- SCHOOL_NUMBER는 PK로 설정된 컬럼이므로 NULL 불가
VALUES(4, NULL); -- SCHOOL_NUMBER는 PK로 설정된 컬럼이므로 NULL 불가





